{"remainingRequest":"/space/metadata/ui/node_modules/babel-loader/lib/index.js!/space/metadata/ui/src/api/SearchApi.js","dependencies":[{"path":"/space/metadata/ui/src/api/SearchApi.js","mtime":1707869128059},{"path":"/space/metadata/ui/node_modules/cache-loader/dist/cjs.js","mtime":1707869666420},{"path":"/space/metadata/ui/node_modules/babel-loader/lib/index.js","mtime":1707869666788}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport { polyfill } from 'es6-promise';\nimport 'isomorphic-fetch';\npolyfill();\nexport default {\n  name: 'SearchApi',\n  getFacets: function getFacets(searchType, qtext, activeFacets) {\n    searchType = searchType !== undefined ? searchType : 'all';\n    qtext = qtext !== undefined ? qtext : '';\n    var facets = Object.keys(activeFacets || {}).map(function (facetName) {\n      var constraintType = activeFacets[facetName].type;\n\n      if (constraintType && constraintType.substring(0, 3) === 'xs:') {\n        constraintType = 'range';\n      }\n\n      return {\n        type: 'selection',\n        constraint: facetName,\n        constraintType: constraintType,\n        mode: 'and',\n        value: activeFacets[facetName].values.map(function (facetValue) {\n          if (facetValue.negated) {\n            return {\n              not: facetValue.value\n            };\n          } else {\n            return facetValue.value;\n          }\n        })\n      };\n    });\n    return fetch('/api/search/' + searchType, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json'\n      },\n      body: JSON.stringify({\n        filters: {\n          and: [{\n            type: 'queryText',\n            value: qtext\n          }].concat(facets)\n        },\n        options: {\n          start: 1,\n          pageLength: 0\n        }\n      }),\n      credentials: 'same-origin'\n    }).then(function (response) {\n      return response.json().then(function (json) {\n        return {\n          response: json\n        };\n      });\n    }, function (error) {\n      return error;\n    });\n  },\n  getResults: function getResults(searchType, qtext, activeFacets, start, pageLength) {\n    searchType = searchType !== undefined ? searchType : 'all';\n    qtext = qtext !== undefined ? qtext : '';\n    start = start || 1;\n    pageLength = pageLength || 10;\n    var facets = Object.keys(activeFacets || {}).map(function (facetName) {\n      var constraintType = activeFacets[facetName].type;\n\n      if (constraintType && constraintType.substring(0, 3) === 'xs:') {\n        constraintType = 'range';\n      }\n\n      return {\n        type: 'selection',\n        constraint: facetName,\n        constraintType: constraintType,\n        mode: 'and',\n        value: activeFacets[facetName].values.map(function (facetValue) {\n          if (facetValue.negated) {\n            return {\n              not: facetValue.value\n            };\n          } else {\n            return facetValue.value;\n          }\n        })\n      };\n    });\n    return fetch('/api/search/' + searchType, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json'\n      },\n      body: JSON.stringify({\n        filters: {\n          and: [{\n            type: 'queryText',\n            value: qtext\n          }].concat(facets)\n        },\n        options: {\n          start: start,\n          pageLength: pageLength\n        }\n      }),\n      credentials: 'same-origin'\n    }).then(function (response) {\n      return response.json().then(function (json) {\n        return {\n          response: json\n        };\n      });\n    }, function (error) {\n      return error;\n    });\n  },\n  suggest: function suggest(searchType, ptext, activeFacets) {\n    searchType = searchType !== undefined ? searchType : 'all';\n    ptext = ptext !== undefined ? ptext : '';\n    /*var facets =*/\n\n    Object.keys(activeFacets || {}).map(function (facetName) {\n      var constraintType = activeFacets[facetName].type;\n\n      if (constraintType && constraintType.substring(0, 3) === 'xs:') {\n        constraintType = 'range';\n      }\n\n      return {\n        type: 'selection',\n        constraint: facetName,\n        constraintType: constraintType,\n        mode: 'and',\n        value: activeFacets[facetName].values.map(function (facetValue) {\n          if (facetValue.negated) {\n            return {\n              not: facetValue.value\n            };\n          } else {\n            return facetValue.value;\n          }\n        })\n      };\n    }); // TODO: expose /api/search/{type}/suggest in middle-tier, and call that\n    //       as /v1/suggest doesn't understand search filters\n\n    return fetch('/v1/suggest?options=' + searchType + '&partial-q=' + encodeURIComponent(ptext), {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json'\n      },\n      credentials: 'same-origin'\n    }).then(function (response) {\n      return response.json().then(function (json) {\n        return json;\n      });\n    }, function (error) {\n      return error;\n    });\n  }\n};",{"version":3,"sources":["/space/metadata/ui/src/api/SearchApi.js"],"names":["polyfill","name","getFacets","searchType","qtext","activeFacets","undefined","facets","Object","keys","map","facetName","constraintType","type","substring","constraint","mode","value","values","facetValue","negated","not","fetch","method","headers","Accept","body","JSON","stringify","filters","and","concat","options","start","pageLength","credentials","then","response","json","error","getResults","suggest","ptext","encodeURIComponent"],"mappings":"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","sourcesContent":["import { polyfill } from 'es6-promise';\nimport 'isomorphic-fetch';\n\npolyfill();\n\nexport default {\n  name: 'SearchApi',\n\n  getFacets(searchType, qtext, activeFacets) {\n    searchType = searchType !== undefined ? searchType : 'all';\n    qtext = qtext !== undefined ? qtext : '';\n\n    var facets = Object.keys(activeFacets || {}).map(function(facetName) {\n      var constraintType = activeFacets[facetName].type;\n      if (constraintType && constraintType.substring(0, 3) === 'xs:') {\n        constraintType = 'range';\n      }\n      return {\n        type: 'selection',\n        constraint: facetName,\n        constraintType: constraintType,\n        mode: 'and',\n        value: activeFacets[facetName].values.map(function(facetValue) {\n          if (facetValue.negated) {\n            return { not: facetValue.value };\n          } else {\n            return facetValue.value;\n          }\n        })\n      };\n    });\n\n    return fetch('/api/search/' + searchType, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json'\n      },\n      body: JSON.stringify({\n        filters: {\n          and: [\n            {\n              type: 'queryText',\n              value: qtext\n            }\n          ].concat(facets)\n        },\n        options: {\n          start: 1,\n          pageLength: 0\n        }\n      }),\n      credentials: 'same-origin'\n    }).then(\n      response => {\n        return response.json().then(function(json) {\n          return { response: json };\n        });\n      },\n      error => {\n        return error;\n      }\n    );\n  },\n  getResults(searchType, qtext, activeFacets, start, pageLength) {\n    searchType = searchType !== undefined ? searchType : 'all';\n    qtext = qtext !== undefined ? qtext : '';\n    start = start || 1;\n    pageLength = pageLength || 10;\n\n    var facets = Object.keys(activeFacets || {}).map(function(facetName) {\n      var constraintType = activeFacets[facetName].type;\n      if (constraintType && constraintType.substring(0, 3) === 'xs:') {\n        constraintType = 'range';\n      }\n      return {\n        type: 'selection',\n        constraint: facetName,\n        constraintType: constraintType,\n        mode: 'and',\n        value: activeFacets[facetName].values.map(function(facetValue) {\n          if (facetValue.negated) {\n            return { not: facetValue.value };\n          } else {\n            return facetValue.value;\n          }\n        })\n      };\n    });\n\n    return fetch('/api/search/' + searchType, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json'\n      },\n      body: JSON.stringify({\n        filters: {\n          and: [\n            {\n              type: 'queryText',\n              value: qtext\n            }\n          ].concat(facets)\n        },\n        options: {\n          start: start,\n          pageLength: pageLength\n        }\n      }),\n      credentials: 'same-origin'\n    }).then(\n      response => {\n        return response.json().then(function(json) {\n          return { response: json };\n        });\n      },\n      error => {\n        return error;\n      }\n    );\n  },\n  suggest(searchType, ptext, activeFacets) {\n    searchType = searchType !== undefined ? searchType : 'all';\n    ptext = ptext !== undefined ? ptext : '';\n\n    /*var facets =*/ Object.keys(activeFacets || {}).map(function(facetName) {\n      var constraintType = activeFacets[facetName].type;\n      if (constraintType && constraintType.substring(0, 3) === 'xs:') {\n        constraintType = 'range';\n      }\n      return {\n        type: 'selection',\n        constraint: facetName,\n        constraintType: constraintType,\n        mode: 'and',\n        value: activeFacets[facetName].values.map(function(facetValue) {\n          if (facetValue.negated) {\n            return { not: facetValue.value };\n          } else {\n            return facetValue.value;\n          }\n        })\n      };\n    });\n\n    // TODO: expose /api/search/{type}/suggest in middle-tier, and call that\n    //       as /v1/suggest doesn't understand search filters\n    return fetch(\n      '/v1/suggest?options=' +\n        searchType +\n        '&partial-q=' +\n        encodeURIComponent(ptext),\n      {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n          Accept: 'application/json'\n        },\n        credentials: 'same-origin'\n      }\n    ).then(\n      response => {\n        return response.json().then(function(json) {\n          return json;\n        });\n      },\n      error => {\n        return error;\n      }\n    );\n  }\n};\n"]}]}