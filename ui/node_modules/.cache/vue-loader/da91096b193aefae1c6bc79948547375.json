{"remainingRequest":"C:\\demo\\metadata\\ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\demo\\metadata\\ui\\src\\views\\DetailPage.vue?vue&type=style&index=0&id=7407503a&lang=less&scoped=true&","dependencies":[{"path":"C:\\demo\\metadata\\ui\\src\\views\\DetailPage.vue","mtime":1708045377000},{"path":"C:\\demo\\metadata\\ui\\node_modules\\css-loader\\index.js","mtime":1707869665000},{"path":"C:\\demo\\metadata\\ui\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1707869662000},{"path":"C:\\demo\\metadata\\ui\\node_modules\\postcss-loader\\src\\index.js","mtime":1707869661000},{"path":"C:\\demo\\metadata\\ui\\node_modules\\less-loader\\dist\\cjs.js","mtime":1707869664000},{"path":"C:\\demo\\metadata\\ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1707869666000},{"path":"C:\\demo\\metadata\\ui\\node_modules\\vue-loader\\lib\\index.js","mtime":1707869662000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nview-binary {\n  display: block;\n  height: 600px;\n}\n",{"version":3,"sources":["DetailPage.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmZA;AACA;AACA;AACA","file":"DetailPage.vue","sourceRoot":"src\\views","sourcesContent":["<template>\n  <div class=\"row detail\">\n    <div class=\"col-sm-8 content-col\">\n      <h3>{{ metadata.fileName }} ({{ metadata.contentType }})</h3>\n      <div class=\"card\">\n        <b-tabs card no-fade v-model=\"tabIndex\">\n          <b-tab title=\"詳細\" active>\n            <dl class=\"row\">\n              <dt v-show=\"metadata.collections\" class=\"col-sm-2\">Collections</dt>\n              <dd v-show=\"metadata.collections\" class=\"col-sm-10\">\n                <span v-for=\"(c, $index) in metadata.collections\" :key=\"$index\">\n                  {{ c }}<span v-show=\"$index !== metadata.collections.length - 1\">, </span>\n                </span>\n              </dd>\n\n              <dt class=\"col-sm-2\">Content-Type</dt>\n              <dd class=\"col-sm-10\">{{ metadata.contentType }}</dd>\n\n              <dt class=\"col-sm-2\">File Name</dt>\n              <dd class=\"col-sm-10\">{{ metadata.fileName }}</dd>\n\n              <dt class=\"col-sm-2\">Format</dt>\n              <dd class=\"col-sm-10\">{{ metadata.format }}</dd>\n\n              <dt v-show=\"metadata.metadataValues\" class=\"col-sm-2\">Metadata</dt>\n              <dd v-show=\"metadata.metadataValues\" class=\"col-sm-10\">\n                <dl class=\"row\">\n                  <template v-for=\"(v, key, $index) in metadata.metadataValues\">\n                    <dt class=\"col-sm-2\" :key=\"$index\">{{ key }}</dt>\n                    <dd class=\"col-sm-10\" :key=\"$index\">{{ v }}</dd>\n                  </template>\n                </dl>\n              </dd>\n\n              <dt v-show=\"metadata.permissions\" class=\"col-sm-2\">Permissions</dt>\n              <dd v-show=\"metadata.permissions\" class=\"col-sm-10\">\n                <span v-for=\"(p, $index) in metadata.permissions\" :key=\"$index\">\n                  {{ p }}<span v-show=\"$index !== metadata.permissions.length - 1\">, </span>\n                </span>\n              </dd>\n\n              <dt class=\"col-sm-2\">Quality</dt>\n              <dd class=\"col-sm-10\">{{ metadata.quality }}</dd>\n\n              <dt class=\"col-sm-2\">Size</dt>\n              <dd class=\"col-sm-10\">{{ metadata.size }} bytes</dd>\n\n              <dt class=\"col-sm-2\">Uri</dt>\n              <dd class=\"col-sm-10\">{{ metadata.uri }}</dd>\n            </dl>\n\n            <h3>内容</h3>\n          <!-- \n            <pre>{{assetHref}}</pre>\n            <pre>{{ json.envelope.instance.Manual.filePath }}</pre>\n          -->\n\n              <view-binary :src=\"assetHref\" :type=\"metadata.contentType\" :title=\"metadata.fileName\">\n                <a slot=\"fallback\" class=\"btn btn-default\" :href=\"downloadUri\" target=\"_blank\" download>Download</a>\n              </view-binary>\n\n\n\n\n          </b-tab>\n          <b-tab title=\"プレビュー\">\n            <div v-if=\"metadata.format === 'json' && json\">\n              <friendly-json :json=\"json\"></friendly-json>\n            </div>\n            <div v-else-if=\"metadata.format === 'xml' && raw\">\n              <friendly-xml :xml=\"raw\"></friendly-xml>\n            </div>\n            <div v-else>\n              <view-binary :src=\"viewUri\" :type=\"metadata.contentType\" :title=\"metadata.fileName\">\n                <a slot=\"fallback\" class=\"btn btn-default\" :href=\"downloadUri\" target=\"_blank\" download>Download</a>\n              </view-binary>\n            </div>\n          </b-tab>\n          <b-tab title=\"オリジナルドキュメント\" v-show=\"raw\">\n            <pre>{{ raw }}</pre>\n          </b-tab>\n\n        </b-tabs>\n      </div>\n    </div>\n    <div class=\"col-sm-4 right-col\">\n      <div id=\"buttons-detail\">\n        <router-link tag=\"button\" class=\"btn btn-default\"\n                 :to=\"{ name: 'root.search' }\">検索</router-link>\n<!--\n        <router-link tag=\"button\" class=\"btn btn-primary\"\n                v-show=\"!profile.disallowUpdates\"\n                :to=\"{ name: 'root.edit', params: { id: id } }\">編集</router-link>\n-->\n        <button class=\"btn btn-primary\"\n                v-show=\"!profile.disallowUpdates\"\n                v-on:click.prevent=\"deleteDoc()\">削除</button>\n      </div>\n      <br>\n      <!-- show (links to) similar documents -->\n      <div class=\"card similar\">\n        <div class=\"card-header\">類似ファイル</div>\n        <div class=\"card-body\"> <ml-similar :uri=\"uri\" limit=\"5\"></ml-similar> </div>\n      </div>\n\n\n      <!-- collection add/remove -->\n\n      <div class=\"card collection\">\n        <div class=\"card-header\">タグ</div>\n        <div class=\"card-body\"> \n\n\n            <div id=\"app\">\n              <ul>\n                <div v-for=\"item in items\" :key=\"item\" >\n                  <input type=\"checkbox\" :id=\"item\" :value=\"item\" v-model=\"checkedCollections\" />\n                  <label :for=\"item\">&emsp;{{item}}</label>\n                </div>\n              </ul>\n            </div>\n            <div id=\"app\">\n              削除するタグ : {{ checkedCollections }}\n              <button class=\"btn btn-primary\" v-on:click=\"buttonClickedRemove\">削除実行</button>\n              <p/>\n              <input v-model=\"addedCollections\" placeholder=\"タグ名称\"><br/>\n              追加するタグ : {{ addedCollections }}\n              <button class=\"btn btn-primary\" v-on:click=\"buttonClickedAdd\">追加実行</button>\n              <p/>\n            </div>\n\n        </div>\n      </div>\n\n\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from \"axios\";\nimport mlSimilar from '@/components/ml-similar.vue';\nimport friendlyJson from '@/components/friendly-json.vue';\nimport friendlyXml from '@/components/friendly-xml.vue';\n\n//import Pdf from 'vue-pdf';\n//import PDFViewer from 'pdf-viewer-vue';\n\n// OR THE FOLLOWING IMPORT FOR VUE 2\nimport PDFViewer from 'pdf-viewer-vue/dist/vue2-pdf-viewer';\n\nexport default {\n  name: 'DetailPage',\n  components: {\n    mlSimilar,\n    friendlyJson,\n    friendlyXml,\n //   PDFViewer,\n  },\n  props: ['type', 'id'],\n  data() {\n    const self = this;\n    return {\n      metadata: {},\n      json: undefined,\n      raw: undefined,\n      tabIndex: 0,\n      checkedCollections: [],\n      addedCollections: [],\n      assetHref: \" \",\n\n      items:[\n        {\n          text: \" \",\n          active: true,\n        },\n      ],\n\n    };\n  },\n  computed: {\n    uri() {\n      return this.metadata.uri || '';\n    },\n    profile() {\n      return this.$store.state.auth.profile || {};\n    },\n    viewUri() {\n      return '/api/crud/' + this.type + '/' + this.id + '?';\n    },\n    downloadUri() {\n      return this.viewUri + 'download=true';\n    },\n    handleDownload() {\n      console.log('it is downloaded');\n      console.log(this.viewUri + 'download=true');\n      return this.viewUri + 'download=true';\n    }\n  },\n  mounted() {\n    console.log('yota before update()');\n    this.update();\n  },\n  methods: {\n    update() {\n      const self = this;\n\n      console.log('yota inside update()');\n      self.metadata = {};\n      self.json = undefined;\n      self.raw = undefined;\n      self.assetHref = \"\";\n      this.$store\n        .dispatch('crud/' + self.type + '/view', { id: self.id, view: 'metadata' })\n        .then(function(response) {\n            console.log('yota  response.response is error');\n            console.log(response);\n          if (!response.isError) {\n            var metadata = JSON.parse(response.response);\n            var permissions = [];\n            // flatten permissions for simplified display\n            metadata.permissions.forEach(function(p) {\n              p.capabilities.forEach(function(c) {\n                permissions.push(p['role-name'] + ':' + c);\n              });\n            });\n            metadata.permissions = permissions;\n            if (metadata.collections.length === 0) {\n              delete metadata.collections;\n            }\n            if (metadata.permissions.length === 0) {\n              delete metadata.permissions;\n            }\n            if ( metadata.metadataValues && Object.keys(metadata.metadataValues).length === 0) {\n              delete metadata.metadataValues;\n            }\n            self.metadata = metadata;\n\n            if (metadata.format === 'json') {\n              self.$store\n                .dispatch('crud/' + self.type + '/read', { id: self.id })\n                .then(function(response) {\n\n                  let jsonData = JSON.parse(response.response);\n\n                  if (!response.isError) {\n                    self.json = JSON.parse(response.response);\n                    self.raw = JSON.stringify(self.json, null, 2);\n                    self.assetHref = '/v1/documents?uri='+ jsonData.envelope.instance.Manual.filePath;\n                  }\n                });\n            } else if (metadata.format === 'xml') {\n              self.$store.dispatch('crud/' + self.type + '/view', { id: self.id, view: 'indent' })\n                .then(function(response) {\n                  if (!response.isError) { self.raw = response.response; }\n                });\n            }\n          }\n\t  else {\n          }\n\n        }\n       );\n       console.log('yota before getcollection()');\n       this.getCollection();\n       this.updateAccessCount();\n    },\n\n\n    getCollection(){\n      const self = this;\n      console.log(\"GET COLLECTION\");\n     axios\n        .get(\"/v1/resources/partDetailsService\", {\n          params: {\n            \"rs:uri\": this.id,\n          },\n        })\n        .then((response) => {\n          var content = response.data;\n          if (content){\n            console.log(\"-----------------content.collections-----------------\");\n            console.log(content.collections);\n            self.items = content.collections;\n          }\n        })\n        .catch((e) => {\n          console.log(e);\n        });\n\n\n    },\n    updateAccessCount() {\n      console.log(\"=====   updateAccessCount      ==== \");\n\n      var para = {\"rs:uri\": encodeURIComponent(this.id)};\n      axios\n        .put(\"/v1/resources/updateAccess?rs:uri=\"+encodeURIComponent(this.id), para)\n        .then((response) => {\n          console.log(\"++++++++ RESPONSE ++++++++\")\n          console.log(response.data);\n        })\n        .catch((e) => {\n          console.log(e);\n        });\n    },\n    deleteDoc() {\n      const self = this;\n      if (\n        window.confirm(\n          'This will permanently delete ' +\n            self.metadata.fileName +\n            ', are you sure?'\n        )\n      ) {\n        const toast = self.$parent.$refs.toast;\n    //    self.$store\n    //      .dispatch('crud/' + self.type + '/delete', { id: self.id })\n\n        var para = {\"rs:uri\": encodeURIComponent(this.id)};\n        axios\n          .delete(\"/v1/resources/deleteBoth?rs:uri=\"+encodeURIComponent(this.id), para)\n          .then(function(response) {\n            if (response.isError) {\n              toast.showToast('Failed to delete the document', {\n                theme: 'error'\n              });\n            } else {\n              toast.showToast('Successfully deleted the document', {\n                theme: 'success'\n              });\n              self.$router.push({\n                name: self.previousRoute\n                  ? self.previousRoute.name\n                  : 'root.search',\n                params: {\n                  refresh: true,\n                  ...(self.previousRoute ? self.previousRoute.params : {})\n                }\n              });\n            }\n          });\n      }\n    },\n\n    buttonClickedRemove(){\n        window.alert(\"Collection Removed\");\n        console.log(this.checkedCollections);\n        var para = {};\n        para[\"rs.uri\"] = encodeURIComponent(this.id);\n        para[\"rs.op\"] = \"Remove\";\n        para[\"rs.cols\"] = this.checkedCollections;\n\n        axios\n          .put(\"/v1/resources/updateCollections?rs:uri=\"+encodeURIComponent(this.id)+\"&rs:op=Remove\"+\"&rs:cols=\"+this.checkedCollections, para)\n          .then((response) => {\n             console.log(\"++++++++ RESPONSE ++++++++\")\n             console.log(response.data);\nthis.$router.go({path: this.$router.currentRoute.path, force: true});\n             //this.update();\n          })\n          .catch((e) => {\n              console.log(e);\n          })\n    },\n    buttonClickedAdd(){\n        window.alert(\"Collection Added\");\n        console.log(this.addedCollections);\n        var para = {};\n        para[\"rs.uri\"] = encodeURIComponent(this.id);\n        para[\"rs.op\"] = \"Add\";\n        para[\"rs.cols\"] = this.addedCollections;\n\n        axios\n          .put(\"/v1/resources/updateCollections?rs:uri=\"+encodeURIComponent(this.id)+\"&rs:op=Add\"+\"&rs:cols=\"+this.addedCollections, para)\n          .then((response) => {\n             console.log(\"++++++++ RESPONSE ++++++++\")\n             console.log(response.data);\nthis.$router.go({path: this.$router.currentRoute.path, force: true});\n            // this.update();\n          })\n          .catch((e) => {\n              console.log(e);\n          });\n    },\n\n\n  },\n\n  watch: {\n    '$route.params': {\n      handler(params) {\n        if (params) {\n          this.update();\n        }\n      },\n      deep: true\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\nview-binary {\n  display: block;\n  height: 600px;\n}\n</style>\n"]}]}